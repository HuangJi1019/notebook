<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>jiji记事本</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    #editor {
      height: 500px;
      margin-top: 20px;
      border: 2px solid #4caf50;
      background-color: #f1f8e9;
      border-radius: 10px;
      padding: 10px;
    }
    .ql-editor {
      font-family: "Microsoft YaHei", sans-serif;
      font-size: 16px;
      color: #333;
    }
    .custom-tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 16px;
      pointer-events: none;
      white-space: nowrap;
      z-index: 9999;
      display: none;
    }
  </style>
</head>
<body>
  <h1>中文记事本 / Notebook</h1>

  <!-- 工具栏 -->
  <div id="toolbar">
    <span class="ql-formats">
      <button class="ql-bold"></button>
      <button class="ql-italic"></button>
      <button class="ql-underline"></button>
      <button class="ql-strike"></button>
    </span>
    <span class="ql-formats">
      <button class="ql-header" value="1"></button>
      <button class="ql-header" value="2"></button>
    </span>
    <span class="ql-formats">
      <button class="ql-list" value="ordered"></button>
      <button class="ql-list" value="bullet"></button>
    </span>
    <span class="ql-formats">
      <select class="ql-color"></select>
      <select class="ql-background"></select>
    </span>
    <span class="ql-formats">
      <select class="ql-align"></select>
    </span>
    <span class="ql-formats">
      <button class="ql-image"></button>
      <button class="ql-link"></button>
    </span>
    <span class="ql-formats">
      <button class="ql-clean"></button>
    </span>
  </div>

  <!-- 编辑器 -->
  <div id="editor"></div>

  <!-- 自定义Tooltip容器 -->
  <div id="customTooltip" class="custom-tooltip"></div>

  <!-- 引入 Quill -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

  <!-- 初始化 Quill -->
  <script>
    const quill = new Quill('#editor', {
      theme: 'snow',
      modules: {
        toolbar: '#toolbar'
      }
    });

    quill.root.innerHTML = '<p>欢迎使用自定义文本框！这里可以写字。</p>';

    const tooltips = {
      'bold': '加粗',
      'italic': '斜体',
      'underline': '下划线',
      'strike': '删除线',
      'header[value="1"]': '标题1',
      'header[value="2"]': '标题2',
      'list[value="ordered"]': '有序列表',
      'list[value="bullet"]': '无序列表',
      'color': '文字颜色',
      'background': '背景颜色',
      'align': '对齐方式',
      'image': '插入图片',
      'link': '插入链接',
      'clean': '清除格式'
    };

    const tooltipEl = document.getElementById('customTooltip');
    Object.keys(tooltips).forEach(selector => {
      document.querySelectorAll(`.ql-${selector}`).forEach(button => {
        button.addEventListener('mouseenter', (e) => {
          tooltipEl.textContent = tooltips[selector];
          tooltipEl.style.display = 'block';
          const rect = e.target.getBoundingClientRect();
          tooltipEl.style.left = `${rect.left + window.scrollX + rect.width / 2}px`;
          tooltipEl.style.top = `${rect.top + window.scrollY - 40}px`;
        });
        button.addEventListener('mouseleave', () => {
          tooltipEl.style.display = 'none';
        });
      });
    });

    // 监听全局复制事件
    document.addEventListener('copy', function(e) {
      // 1️⃣ 获取用户当前选择的文本
      const selectedText = window.getSelection().toString();

      // 2️⃣ 替换the ... solid-state之间的所有$
      const transformedText = selectedText.replace(/(the[\s\S]*?solid-state)/gi, (match) => {
        return match.replace(/\$/g, '86Rb');
      });

      // 3️⃣ 写入剪贴板
      e.clipboardData.setData('text/plain', transformedText);
      e.preventDefault();
    });
  </script>
</body>
</html>
